---
title: "Summary of the Iberian Bees Database"
author: I. Bartomeus, T. Wood, L. Carvalheiro, C. Molina, et al. - 
date: "`r format(Sys.time(), '%d %B, %Y')`"
#output: pdf_document
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
data <- read.csv("data/data_clean.csv", stringsAsFactors = FALSE)
master <- read.csv("data/Iberian_species_masterlist.csv", stringsAsFactors = FALSE)
master$accepted_name <- paste(master$Genus, master$Species, sep = " ")
colnames(data)
colnames(master)
data[which(!data$accepted_name %in% master$accepted_name),] #OK
master[which(!master$accepted_name %in% data$accepted_name),] 
#we are missing ~100 species, mostly parasites!
length(unique(data$accepted_name))
nrow(master)
```

The Iberian Bee Database contains `r nrow(data)` entries of bee occurrences over the peninsula and nearby islands. We have at least one record of `r length(unique(data$accepted_name))` species out of the `r nrow(master)` species known to occurr in the area. 

We retained only valid, updated species names. All records have accompaining metadata on where and when it was collected, and on who collected, identified and curated the data. We are still reciving and cleaning data, but we aim to publish the open database after summer.

Here we present a summary of the database:

## Where are the records? 

We have records all over the peninsula, but higer concentrations are marked in red.  

```{r echo=FALSE, message=FALSE, warning=FALSE}
#map
library(rgdal)
library(ggplot2)

ESPTmap <- map_data("world", region = c("Portugal", "Spain"))

plotmap <- ggplot(data = data, aes(x = Longitude, y = Latitude)) +  # plot the data
           geom_polygon(data = ESPTmap, aes(x = long, y = lat, group = group),            # plot Spain
                        color = "black", fill = "white") + coord_fixed() +    # coord_fixed() ensures that one unit on the x-axis is the same length as one unit on the y-axis
           geom_point(color = "dodgerblue4", size = 2, shape = ".") +                   # graphical parameters for points
           stat_density2d(aes(x = jitter(Longitude),                           # create the density layer based on where the points are
                              y = jitter(Latitude),  fill = ..level.., alpha = ..level..),   # colour and transparency depend on density
           geom = "polygon", colour = "grey95",size=0.3) +            # graphical parameters for the density layer
           scale_fill_gradient(low = "yellow", high = "red") +                 # set colour palette for density layer
           scale_alpha(range = c(.25, .5), guide = FALSE) +                    # set transparency for the density layer 
           theme(axis.title.x=element_blank(), axis.text.x=element_blank(),  # don't display x and y axes labels, titles and tickmarks 
           axis.ticks.x=element_blank(),axis.title.y=element_blank(),   
           axis.text.y=element_blank(), axis.ticks.y=element_blank(),
           #text=element_text(size=18),legend.position = c(.9, .15),       # size of text and position of the legend
           panel.grid.major = element_blank(),                            # eliminates grid lines from background
           panel.background = element_blank())                            # set white background
# now plot, it takes a while!
plotmap
```

## Which are the most reported species?   

Here we show the top-20 most abundant species excluding _Apis mellifera_.  

```{r echo=FALSE}
#barplot of top 10 species
data2 <- subset(data, accepted_name != "Apis mellifera")
default <- par()$mar
par(mar = c(10.1, 4.1, 4.1, 2.1))
barplot(head(sort(table(data2$accepted_name), decreasing = TRUE),20), las = 2, cex.names = 0.7)
#barplot(tail(sort(table(data2$accepted_name), decreasing = TRUE),20), las = 2, cex.names = 0.7)
par(mar = default)
```

## When are we recording more bees?  

```{r echo=FALSE, warning=FALSE}
hist(data2$Year, main = "Most records are recorded since year 2000", 
     las = 1, xlab = "Year")
```


```{r echo=FALSE, warning=FALSE}
hist(data2$Month, main = "Most records are recorded in April",
     las = 1, xlab = "Month", breaks = 12)
```

## Who make this posible?

This is a large collaborative effort lead by I. Bartomeus, L. Carvalheiro and T. Woods, but it would not be possible without the contribution of thousends of researchers. Those are the main contributors, but more contributors will be joining soon!

```{r echo=FALSE, message=FALSE, warning=FALSE}
#table of
#Name	
#Contact	
#Number of records as main dataholder	
#Number of records as co-dataholder
#email?? Maually :(
#default <- par()$mar
#par(mar = c(13.1, 4.1, 4.1, 2.1))
#barplot(head(sort(table(data2$Authors.to.give.credit), decreasing = TRUE),20), las = 2, cex.names = 0.7)
#par(mar = default)
#Can be done prettier.
#Ideally, we can merge all authors, split and count individually.
library(stringi)
authors <- data$Authors.to.give.credit[which(!is.na(data$Authors.to.give.credit))]
authors[which(authors == "Ornosa, C., Martínez, M. D.")] <- "C. Ornosa, M.D. Martínez"
authors[which(authors == "C. Ornosa & F. J. Ortiz-Sánchez")] <- "C. Ornosa, F. J. Ortiz-Sánchez"
authors[which(authors == "C. Ornosa & M.D. Martínez")] <- "C. Ornosa, M.D. Martínez"
authors[which(authors == "Ortiz-Sanchez, F.J.")] <- "F.J. Ortiz-Sanchez"
authors[which(authors == "Heras, C., Gayubo, S. F.")] <- "C. Heras, S.F. Gayubo"
authors[which(authors == "Ornosa, C.")] <- "C. Ornosa"
authors[which(authors == "Herrera, J.")] <- "Javier Herrera"
authors[which(authors == "Francisco Javier Ortiz-Sánchez, Pedro Coello & Manuel Baena")] <- "Francisco Javier Ortiz-Sánchez, Pedro Coello, Manuel Baena"
authors[which(authors == "González, J. A., Torres, F., Gayubo, S. F.")] <- "J.A. González, , F. Torres, S.F. Gayubo"
authors[which(authors == "Dardón, M. J., Torres, F., Asís, J. D.")] <- "M.J. Dardón, F. Torres, J.D. Asís"
authors[which(authors == "Pérez-Iñigo Mora, C.")] <- "C. Pérez-Iñigo Mora"
authors[which(authors == "Pablo Vargas, Concepción Ornosa, Francisco Javier Ortiz-Sánchez & Juan Arroyo")] <- "Pablo Vargas, Concepción Ornosa, Francisco Javier Ortiz-Sánchez, Juan Arroyo"
authors[which(authors == "C. Heras y S.F. Gayubo")] <- "C. Heras, S.F. Gayubo"
authors[which(authors == "J. L. BLANCO-PASTOR, C. ORNOSA, D. ROMERO, I. M. LIBERAL, J. M. GÓMEZ & P. VARGAS")] <- "J. L. Blanco-Pastor, C. Ornosa, D. Romero, I.M. Liberal, J.M. Gómez, P. Vargas"
authors[which(authors == "Concepción Ornosa, Félix Torres & Pilar de la Rúa")] <- "Concepción Ornosa, Félix Torres, Pilar de la Rúa"
authors[which(authors == "Castro, L.")] <- "L. Castro"
authors[which(authors == "Ortiz-Sanchez, F. J., Ornosa, C.")] <- "F.J. Ortiz-Sanchez, C. Ornosa"
authors[which(authors == "Banaszak, J., Ortiz-Sanchez, F. J.")] <- "J. Banaszak, F.J. Ortiz-Sanchez"
authors[which(authors == "C. Ornosa, F. Torres & F. J. Ortiz-Sánchez")] <- "C. Ornosa, F. Torres, F. J. Ortiz-Sánchez"

author_pool <- stri_paste(authors, collapse = ",")
author_list <- unlist(strsplit(author_pool, ","))
author_list <- trimws(author_list)
#sort(unique(author_list))[-1] #79 contributors!
#write.csv(sort(unique(author_list))[-1], "data/authors.csv")

auth <- c(
"Alejandro Núñez"
,"Amparo Lázaro"
,"Ana Montero-Castaño"
,"Anna Traveset"
,"Blanca Arroyo-Correa"
,"C. Heras"
,"Curro Molina"
,"C. O’Connor"
,"Concepción Ornosa"
,"C. Pérez-Iñigo Mora"
,"Carlos Lara-Romero"
,"T. Wood"
,"Concepción Ornosa"
,"Concepción Ornosa"
,"D. Paredes"
,"D. Romero"
,"David Alomar"
,"F. Javier Ortiz-Sánchez"
,"F. Javier Ortiz-Sánchez"
,"F. López-Núñez"
,"F. Perfectti"
,"Félix Torres"
,"F. Javier Ortiz-Sánchez"
,"Félix Torres"
,"F. Javier Ortiz-Sánchez"
,"H. Gaspar"
,"Ignasi Bartomeus"
,"Isabel María Liberal"
,"Isabel María Liberal"
,"J. Ascher"
,"J. Banaszak"
,"J. Bosch"
,"J. Dusmet"
,"J. Gonzalez-Varo"
,"J. L. Blanco-Pastor"
,"J. Loureiro"
,"J. R. Obeso"
,"J.A. González"
,"J. Bosch"
,"J.D. Alche"
,"J.D. Asís"
,"J.M. Gómez"
,"Javier Herrera"
,"Javier Morente-López"
,"Joana Costa"
,"José Iriondo"
,"Jose Luis Blanco-Pastor"
,"Juan Arroyo"
,"L. Castro"
,"Luis Navarro"
,"M. Campos"
,"M. Miñarro"
,"M. Porcel"
,"M.D. Martínez"
,"M.J. Dardón"
,"M.L. Fernández"
,"Montserrat Vilà"
,"Manuel Baena"
,"Marina Alonso Solano"
,"Mario Fernández-Mazuecos"
,"Carlos Martínez-Núñez"
,"Miguel A. González-Estévez"
,"Montserrat Vilà"
,"Pablo Vargas"
,"Pablo Vargas"
,"Pedro Coello"
,"Pilar de la Rúa"
,"R. Alcalá"
,"R. Carvalho"
,"R. Heleno"
,"P.J. Rey"
,"S. Castro"
,"S. Castro"
,"S.F. Gayubo"
,"Victoria Ferrero"
,"Volker Haeseler")

unique(auth)
```

The list of co-authors is not exhaustive, and we did not carefully checked contributor names yet. Contact nacho.bartomeus@gmail.com if you want to contribute.

