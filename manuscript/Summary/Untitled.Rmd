---
title: "Summary of the Iberian Bees Database"
author: I. Bartomeus, T. Wood, L. Carvalheiro, C. Molina, et al. - 
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: pdf_document
#output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
library(data.table)
data <- read.table("../../Data/iberian_bees.csv.gz",  header=T, quote="\"", sep=",")

master <- read.csv("../../Data/Processing_iberian_bees_raw/Iberian_species_masterlist.csv", stringsAsFactors = FALSE)
master$accepted_name <- paste(master$Genus, master$Species, sep = " ")
colnames(data)
colnames(master)
data[which(!data$accepted_name %in% master$accepted_name),] #OK
master[which(!master$accepted_name %in% data$accepted_name),] 
#we are missing ~100 species, mostly parasites!
length(unique(data$accepted_name))
nrow(master)
```

The Iberian Bee Database contains `r nrow(data)` entries of bee occurrences over the peninsula and nearby islands. We have at least one record of `r length(unique(data$accepted_name))` species out of the `r nrow(master)` species known to occurr in the area. 

We retained only valid, updated species names. All records have accompaining metadata on where and when it was collected, and on who collected, identified and curated the data. We are still reciving and cleaning data, but we aim to publish the open database after summer.

Here we present a summary of the database:

## Where are the records? 

We have records all over the peninsula, but higer concentrations are marked in yellow. The scale is the logarithm of the number of occurrences.  

```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
#map
library(rgdal)
library(ggplot2)

ESPTmap <- map_data("world", region = c("Portugal", "Spain"))

plotmap <- ggplot(data = data, aes(x = Longitude, y = Latitude)) +  # plot the data
           geom_polygon(data = ESPTmap, aes(x = long, y = lat, group = group),            # plot Spain
                        color = "black", fill = "white") + coord_fixed() +    # coord_fixed() ensures that one unit on the x-axis is the same length as one unit on the y-axis
           geom_point(color = "dodgerblue4", size = 2, shape = ".") +                   # graphical parameters for points
           stat_density2d(aes(x = jitter(Longitude),                           # create the density layer based on where the points are
                              y = jitter(Latitude),  fill = ..level.., alpha = ..level..),   # colour and transparency depend on density
           geom = "polygon", colour = "grey95",size=0.3) +            # graphical parameters for the density layer
           scale_fill_gradient(low = "yellow", high = "red") +                 # set colour palette for density layer
           scale_alpha(range = c(.25, .5), guide = FALSE) +                    # set transparency for the density layer 
           theme(axis.title.x=element_blank(), axis.text.x=element_blank(),  # don't display x and y axes labels, titles and tickmarks 
           axis.ticks.x=element_blank(),axis.title.y=element_blank(),   
           axis.text.y=element_blank(), axis.ticks.y=element_blank(),
           #text=element_text(size=18),legend.position = c(.9, .15),       # size of text and position of the legend
           panel.grid.major = element_blank(),                            # eliminates grid lines from background
           panel.background = element_blank())                            # set white background
# now plot, it takes a while!
plotmap
```
