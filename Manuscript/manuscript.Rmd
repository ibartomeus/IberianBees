---
title: "| Base de datos de abejas Ibéricas \n| Iberian Bees database\n"
author: Ignasi Bartomeus^1^, Jose B. Lanuza^1^, Thomas Wood^2^, Luisa Carvalheiro^3,4^, and a lot of coauthors to be added^5^s
output:
  pdf_document: default
  word_document:
    fig_caption: yes
    fig_height: 6
    fig_width: 7.5
    highlight: null
    reference_docx: Ecosistemas_template.docx
csl: ecosistemas.csl
bibliography:
- references.bib
- knitcitations.bib
editor_options: 
  chunk_output_type: console
  
header-includes:
#To find unicode issues on refs
- \DeclareUnicodeCharacter{0301}{*************************************}
  
---

```{r include=FALSE}

#Load main libraries at once
library(tidyverse)
library(dplyr)
library(data.table)

#To obtain the same template
# install.packages("remotes")
#remotes::install_github("Pakillo/template")

```


```{r knitcitations, echo=FALSE, cache = FALSE}
library(knitcitations)
cleanbib()   
cite_options(citation_format = "pandoc")
```



```{r include=FALSE}
#Load data
data <- read.table("../Data/iberian_bees.csv.gz",  header=T, quote="\"", sep=",")
#Delete first col that are rownames
data <- data %>% select(-X)

#Load Iberianbees masterlist
master <- read.csv("../Data/Processing_iberian_bees_raw/Iberian_species_masterlist.csv", stringsAsFactors = FALSE)

#Load removed species from the database
removed <- read.csv("../Data/Processing_iberian_bees_raw/removed.csv")
master$Accepted_name <- paste(master$Genus, master$Species, sep = " ")
data$Latitude <- as.numeric(data$Latitude)
data$Longitude <- as.numeric(data$Longitude)

#Create vector with info for abstract
#Geo
geo <- length(which(!is.na(data$Latitude) & !is.na(data$Longitude)))
#Flowers
flw <- length(which(!is.na(data$Flowers.visited)))
#Locality
local <- length(which(!is.na(data$Locality)))
#Colector and ide by
deter <- length(which(!is.na(data$Collector) & !is.na(data$Determined.by)))
#Locality
date <- length(which(!is.na(data$Year) & !is.na(data$Month) & !is.na(data$Day)))



#Date for the ones that do not have specific date (range date)
date_1 <- data[is.na(data$Latitude) & is.na(data$Longitude),]
date_2 <- length(which(!is.na(date_1$Start.date) & !is.na(date_1$End.date)))

```

> (1) Departamento de Ecología Integrativa, Estación Biológica de Doñana (EBD-CSIC), Consejo Superior de Investigaciones Científicas, Avda. Américo Vespucio s/n, E-41092 Sevilla, España.
> (2) 
> (3) CE3C, Universidade de Lisboa, Lisboa, Portugal
> (4) Departamento de Ecologia, Universidade Federal de Goiás, Goiânia, Brasil
> (5)

> Autor para correspondencia: I. Bartomeus [nacho.bartomeus@gmail.com]


# Resumen

> **Base de datos de abejas Ibéricas**. Las abejas (Anthophila) son un grupo extremadamente diverso con más de 1000 especies descritas en la Península Ibérica. Además, son excelentes polinizadores y proveen numerosos servicios ecosistémicos fundamentales para la mayoría de ecosistemas terrestres. Debido a los diversos cambios ambientales inducidos por el ser humano, existen evidencias del declive de algunas de sus poblaciones para ciertas especies. Sin embargo, sabemos muy poco del estado de conservación de la mayoría de especies y para muchas de ellas apenas sabemos cual es su distribución en la Península Ibérica. En este trabajo presentamos un esfuerzo colaborativo para agrupar y curar una base de datos de ocurrencias en la Península Ibérica e Islas Baleares que permita responder preguntas sobre su distribución, preferencia de hábitat, fenología o tendencias históricas. En total esta base de datos consta por ahora de `r nrow(data)` registros de `r length(unique(data$Accepted_name))` especies con un `r round(geo/nrow(data),2)*100`% con información georeferenciada recolectada entre `r min(data$Year, na.rm = T)` y `r max(data$Year, na.rm = T)`. Además cada registro tiene información asociada como la localidad de muestreo (`r round(local/nrow(data),2)*100`%), identificador y colector de la especie (`r round(deter/nrow(data),2)*100`%), fecha de captura (`r round(date/nrow(data),2)*100`%) y planta donde se recolectó (`r round(flw/nrow(data),2)*100`%). Creemos que esta base de datos es el punto de partida para conocer y conservar mejor la biodiversidad de abejas en la Península Ibérica e Islas Baleares. Se puede acceder en: https://doi.org/10.5281/zenodo.6354502


# Abstract

> **Iberian Bees database**. Bees are a diverse group with more than 1000 species known from the Iberian Peninsula. They have increasing received special attention due to their important role as pollinators and providers of ecosystem services. In addition, various rapid human-induced environmental changes are leading to the decline of some of its populations. However, we know very little about the conservation status of most species and for many species, we hardly know their true distributions across the Iberian Peninsula. Here we present a collaborative effort to collate and curate a database of Iberian bee occurrences to answer questions about their distribution, habitat preference, phenology, or historical trends. In total we have accumulated `r nrow(data)` records from the Iberian Peninsula and the Balearic Islands of `r length(unique(data$Accepted_name))` different species collected between `r min(data$Year, na.rm = T)` and `r max(data$Year, na.rm = T)`. More than `r round(geo/nrow(data),2)*100`% of these records have associated information such as the location and date of capture, and `r round(flw/nrow(data),2)*100`% have extra data such as the plant species from which it was collected. This database is the starting point to better understand and conserve bee biodiversity in the Iberian Peninsula. It can be accessed at: https://doi.org/10.5281/zenodo.6354502.


# Palabras clave

> Biodiversidad; Apoidea; Polinizadores; Fenología 

# Keywords

> Biodiversity; Apoidea; Pollinators; Phenology

# Background & Summary   

Bees (Hymenoptera, Apoidea, Anthophila) are a diverse group of insects with more than 20.000 species described worldwide [@ascher2020]. The Iberian Peninsula, with its bee-loved Mediterranean climate, is one of the hotspots of bee diversity with more than 1000 species recorded to date and counting [@ascher2020, @ortiz2011 UPDATE TO: Ortiz-Sanchez 2020 Checklist de Fauna Ibérica. Serie Anthophila (Insecta: Hymenoptera: Apoidea) en la península ibérica e islas Baleares (edición 2020)]. Unfortunately, despite the high diversity of Iberian bees, we know very little about the species themselves and their distributions. This is paradoxical, as in recent years bees have been highlighted as a keystone group in the ecosystem due to a key function they provide, the pollination of thousands of plants [@ollerton2011], including most crop species [@klein2007]. In addition, various rapid human-induced environmental changes are leading to the decline of some bee populations [@goulson2015]. However, the response of bee species to global change is heterogeneous both in space and also taxonomically. That is, while in some areas species are declining drastically  [@burkle2013], other areas are well conserved [@herrera2019] and while some species are in the brink of extinction [@cameron2011] some species are even thriving [@russo2016]. A better description of bee distributions, habitat preferences, phenologies, or historical trends in the Iberian Peninsula would require information on when and where different species occur.

In the absence of standardized monitoring efforts, one may think that detailed information on species occurrences in space and time does not exists. However, there are different sources of useful information. First, natural history museums hold historical collections of amateur naturalists and researchers who collected bees [@bartomeus2019]. Collectors are very good at classifying and labeling each collected specimen, which means we can retrieve the information stored along the pinned specimens about when and where those where collected. Second, the Iberian Peninsula has a rich tradition of pollinator and pollination researchers [@archer2014], which have been collecting occurrence bee data with different aims. Finally, many occurrence records are being made available through internet portals which centralize data hosted in institutions all around the world (e.g. Gbif) or collected by citizen scientists (e.g. iNaturalist). The challenge is how to digitalize, access, and curate all these different data sources.

Here we compile an Iberian Bee Database of occurrence records by integrating digitalization efforts by leading national history museums, with more than 100 individual datasets contributed by researchers, and publicly available information on online repositories. After data cleaning and harmonization, we release the first `r nrow(data)` records from the Iberian Peninsula and the Balearic Islands. Figure 1 shows the spatial distribution of records, which as expected its biased to certain areas near main cities (Fig 1). Overall, the database contains information of `r length(unique(data$Accepted_name))` different species, for which the most commonly collected are depictted in Figure 2. The data has been collected between `r min(data$Year, na.rm = T)` and `r max(data$Year, na.rm = T)`, with an increasing trend of the number of records with time, reflecting a renewed interest for documenting this taxa (Figure 3A). Figure 3 also shows the temporal distribution of records within years (Figure 3B). More than `r round(geo/nrow(data),2)*100`% of these records have associated information such as the location and date of capture, and `r round(flw/nrow(data),2)*100`% have extra data such as the plant species where it was collected. This Iberian Bee Database (v.1.0) will continue to grow, but it is the starting point to better understand and conserve bee biodiversity. It can be accessed at: https://doi.org/10.5281/zenodo.6354502.

# Antecedentes y resumen ampliado 

Las abejas (Hymenoptera, Apoidea) son un grupo muy diverso de especies con más de 20.000 especies descritas en el mundo [@ascher2020]. Debido a las condiciones climáticas de la Península Ibérica, esta se caracteriza por ser uno de los puntos calientes de diversidad a nivel mundial con más de 1000 abejas descritas hasta la fecha [@ortiz2011]. A pesar de la gran diversidad de abejas Ibéricas, conocemos muy poco de su ecología y distribución. Paradójicamente las abejas son un un grupo clave que desarrolla una función vital para la moyoría de ecosistemaas terrestres, la polinización de miles de plantas [@ollerton2011] incluyendo a la mayoría de cultivos [@klein2007]. Además el cambio debido al impacto del ser humano esta dando lugar al declive de algunas de sus poblaciones [@goulson2015]. No obstante, la respuesta de las abejas al cambio global es heterogénea tanto en el espacio como taxonomicámente. Es decir, existen áreas que están sufriendo un decaimiento poblacional drástico [@burkle2013] mientras que otras se mantienen bien conservadas [@herrera2019] y mientras que algunas especies se encuntra al borde de la extinción [@cameron2011], otras se encuentran incluso prosperando [@russo2016]. Una mejor descripción de la distribución de las abejas sobre su distribución, preferencia de hábitat, fenología, o tendencias históricas en la Península Ibérica requerirían información de dónde y cuándo las especies aparecen.  

Con la ausencia de esfuerzos de muestreo estandarizados se podría pensar que información detallada de la ocurrencia de especies en el espacio y en el tiempo no existe. Sin embargo, existen diversas fuentes con información muy útil. En primer lugar, los museos de historia natural albergan colecciones históricas de naturalistas amateur e investigadores que coleccionaron abejas [@bartomeus2019]. Puesto que las colecciones de museos suelen estar muy bien clasificadas y etiquetadas, es posible recopilar la información sobre los especímenes de la colección y cuándo y dónde estos fueron capturados. En segundo lugar, la Península Ibérica tiene una rica tradición de investigadores sobre polinizadores y polinización [@archer2014] que han recopilado gran cantidad información de abejas con diferentes objetivos. Finalmente, muchos datos de ocurrencias han sido liberados de forma abierta a través de portales de internet que centralizan datos almacenados por instituciones de todo el mundo (p.ej. Gbif) o datos de ciencia ciudadana (p.ej.iNaturalist). No obstante, sigue siendo un desafio digitalizar, acceder y limpiar toda la información existente de las diferentes fuentes de datos.

En este estudio hemos creado una base datos de abejas Ibéricas (IberianBees) a través de unificar: (i) los esfuerzos de digitalización de museos,  (ii) conjuntos de datos de investigadores, e (iii) información de repositorios en línea de libre acceso. Tras la limpieza de los datos y homogeneización de los mismos para crear la base de datos, nosotros liberamos los primeros `r nrow(data)` registros que abarcan la Península Ibérica e Islas Baleares. La **Figure 1** muestra la distribución espacial de los registros, tal y como se esperaba existe un sesgo hacia ciertas áreas cercanas a los grandes núcleos urbanos. Esta base de datos contiene información sobre `r length(unique(data$Accepted_name))` diferentes especies y las 20 especies más comunes se encuentran representadas con su respectivo número de registros en la **Figura 2**. Los datos han sido recopilados entre `rmin(data$Year, na.rm = T)` y `r max(data$Year, na.rm = T)`, con un ascendente número de registros en el tiempo que refleja el creciente interés de documentar a este grupo taxonómico (**Figura 3A**). Además, como es de esperar la mayoría de registros tienen lugar en los meses de primavera con mayo siendo el mes que consta de un mayor número de registros  (**Figura 3B**). El `r round(geo/nrow(data),2)*100`% de estos registros constan de información georeferenciada y el resto de registros al menos contienen información de la localidad de captura/observación. También un `r round(date/nrow(data),2)*100`% de los diferentes registros poseen información sobre la fecha de captura y para los que no, un `r round(date_2/nrow(data),2)*100`% tienen un intervalo temporal de cuándo se pudieron capturar/observar los diferentes especímenes. Además para un `r round(flw/nrow(data),2)*100`% de los registros hay información de la(s) planta(s) donde se capturo o se produjo la observación. Esta es la versión (v.1.0) de la base de datos de abejas Ibéricas con nombre "IberianBees" que continuará creciendo pero creemos que es un buen punto de partida para empezar a mejorar nuestro conocimiento y conservación de este grupo taxonómico tan importante para nuestros ecosistemas y la producción agrícola. Se puede acceder desde: https://doi.org/10.5281/zenodo.6354502.

# Material y métodos  

## Recopilación de datos originales

*Museos*: Hemos digitalizado el 10% de los espcimenes depositados en el Museo Nacional de Ciencias Natural de Madrid, sobretodo las familias Melitidae y Apidae, para los cuales se han revisado la identificación taxonomicas. Así como recabado información digitalizada de museos extrangereos incluyendo "Naturalis Biodiversity Center" (Holanda), "Oberösterreichisches Landesmuseum" (Austria) y la "Smithosian collection" (USA). En el futuro esta previsto continuar con la digitalización del MNCN, así como añadir otras colecciones hitóricas.

*Proyectos de investigación*: Hemos contactado los principales investigadores en ecología de la polinización de España y Portugal, asi como anunciado en las principales listas de distribución tematicas para recoger datos sobre ocurrencia de abejas en la Peninsula Iberica. Se recogieron `r length(unique(data$Authors.to.give.credit))-2` estudios con datos ya digitalizados. Estos han sido limpiados y homogeneizados (ver más abajo). En el futuro se seguiran añadiendo nuevas contribuciones, asi como se rescatarán datos ya publicados en formatos de dificil extracción como PDF.

*Repositorios de internet*: Usando paquetes programaticos de R (@ropensciINat: https://cran.r-project.org/web/packages/rinat/rinat.pdf, @ropensciGbif: https://cran.r-project.org/web/packages/rgbif/citation.html) descargamos todos los datos de Gbif (https://www.gbif.org) y INaturalist (https://www.inaturalist.org) de ocurrencias de abejas en la peninsula Iberica a fecha 14-03-2022. Estos datos pueden ser actualizados en nuevas versiones automaticamente.

## Tratamiento de datos

Todo el tratamiento de datos se ha hecho de forma reproducible en R `r citep(citation())`. Primero hemos seleccionado los campos comunes que reflejan que especie y de que sexo, cuando fue colectada, y donde, asi como datos de quien fue el colector, quien determinó la identidad de la especie, y referencias de donde ha sido publicada. La Tabla 1 ofrece un resumen de los metadatos creados con  [@dataspice], y que también están disponibles en formato json (indexado por Google datasets) y [@EML_2019]. Debido a la naturaleza variada de este tipo de datos el proceso de limpieza de datos fue un proceso complejo y tedioso. De los `r nrow(data)+nrow(removed)` datos iniciales, `r nrow(removed)` fueron descartados. Todo el proceso así como los datos descartados pueden consultarse aqui: https://github.com/ibartomeus/IberianBees 

En primer lugar se reviso toda la taxonomia de las especies cotejándolos con la lista de especies actualizada para la Península Ibérica [@ortiz2011]. Solo se han aceptado especies correctamente identificadas a nivel de especie. Se han actualizado más de `r length(which(data$Accepted_name != data$original_species))` registros, actualizando todos los sinónimos y corrigiendo errores tipográficos. En segundo lugar, se ha recogido información del país, provincia y localidad del registro. Además se realizó un proceso de estandarización de las geolocalizaciones a latitud y longitud en grados decimales (WGS84) siempre y cuando esta información se encontraba disponible. Aunque también se incluyó información sobre la precisión de las coordenadas, este metadato estaba raramente presente para muchas de las coordenadas. En tercer lugar, se ha incluido también información de la fecha de captura/observación con el día, mes y el año o en su defecto con intervalo temporal orientativo si esto era posible. Los datos con fechas y localizaciones erróneas o ilógicas (e.g. geolocalizaciones en el mar o especimeénes recogidos en el mes 18) han sido corregidos o eliminados. En cuarto lugar, se ha recogido los nombres de los colectores y personas que identificaron las especies, así como información del número de machos, hembras y obreras cuando se especifica. Finalmente, hemos añadido referencias a publicaciones donde se usan estos datos, y otros datos de interés como la planta que estaban visitando, la identificación unica de la base de datos local (si la hay), los autores que han proporcionado los datos y cualquier otra nota de interés si la había.

En la base de datos resultante se ha asignado a cada entrada un identificador unico, y se ha guardado tanto el nombre de la espcecia original tal y como fue inicialmente identificada, como el nombre aceptado final después de haber sido revisado por taxónomos expertos si era necesario. 

## Flujo de trabajo

Toda la base de datos se puede reconstruir de las fuentes originales usando los scripts proporcionados, y por tanto se pueden trazar todas las decisiones tomadas. Se ha creado una plantilla para contribuir con más datos.  

Utilizamos R `r citep(citation())` y Rmarkdown `r citep(list(citation("knitr"), citation("rmarkdown")))` para todos nuestros análisis. 

# Registro y disponibilidad de datos  

Todo el proceso de trabajo esta en abierto en Github y los todos los archivos del código creado tienen licencia MIT (https://opensource.org/licenses/MIT). El uso de datos tine licencia CC-By 4.0 (https://creativecommons.org/licenses/by/4.0/). La versión depositada junto al envio de este paper corresponde a la version 1.0. de IberianBees, y tanto los datos como los scripts tienen una version permanente depositada en Zenodo y citable usando este identificador único. Se usará un sistema de versionado incremental, donde pequeñas correcciones de errores, o incrementos no substanciales de datos recibiran actualizaciones en el primer digito (v1.1, v.1.2, etc...) y actualizaciones mayores en el segundo numero (v2.0, v3.0, etc...). Todas las actualizaciones mayores serán depositadas en Zenodo bajo el DOI general: https://doi.org/10.5281/zenodo.6354502

# Contribución de los autores

IB and JBL cleaned and prepared the database. IB, LGC and TW compiled multiple datasets from museums and individual dataholders. MAC gathered data from the literature. PA digitalized MNCN data, TW and CM provided taxonomic expertise. IB, LGC, TW and JBL wrote the paper. All authors contributed data.

# Agradecimientos

Thanks to the thousands of collectors, naturalists, and scientists who contributed to collect, curate and identify this dataset. We thank project EUCLIPO (Fundaçao para a Ciencia e a Tecnologia, LISBOA-01-0145-FEDER-028360/EUCLIPO) and SAFEGUARD (ref. 101003476 H2020-SFS-2019-2).

# Referencias

```{r write_citations, cache=FALSE, include=FALSE}
write.bibtex(file="knitcitations.bib")
```

<div id = "refs"></div>

###### TABLA 1

**Tabla 1**. Metadatos explicando el significado y las unidades de cada variable en el set de datos. 

**Table 1**. Metadata explaining for each variable in the data set, its meaning and units.

```{r Tabla1, results='asis', echo=FALSE, cache=FALSE}
library("knitr")
metadata <- read.csv("../Data/Metadata/attributes.csv")
kable(metadata[,-1])
```


###### PIES DE FIGURA

**Figura 1**. Barplot indicating the 20 more common recorded species in the final data set.

**Figura 2**. Map of the Iberian Peninsula indicating where the bee occurrences were sampled.

**Figura 3**. Temporal coverage of (A) collection years and (B) collection moths.

###### FIGURE LEGENDS

**Figura 1**. Gráfico de barras indicando la abundancia de las 20 especies más abundantes. 

**Figura 2**. Mapa de la Península Ibérica donde se muestran las zonas con mayor numero de registros.

**Figura 3**. Cobertura temporal de (A) los años con más ocurrencias, y (B) los meses con más ocurrencias. 


```{r Fig1, echo=FALSE, fig.align='center', out.width="70%", fig.cap="\\label{fig:Fig1} Barplot indicating the 20 more common recorded species in the final data set."}
# Prepare top 20 records
top_20 <- data %>%
  filter(!Accepted_name == "Apis mellifera") %>%
  group_by(Accepted_name) %>%
  summarise(no_rows = length(Accepted_name)) %>%
  arrange(-no_rows) %>%
  slice(1:20)
# Fix row position
top_20$Accepted_name <- factor(top_20$Accepted_name, levels = top_20$Accepted_name)
# Plot
ggplot(top_20, aes(x = Accepted_name, y = no_rows)) +
  geom_bar(stat = "identity", fill = "#287D8EFF") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8, face = "italic")) +
  ylab("Number of records") +
  xlab("Species") +
  scale_y_continuous(expand = c(0, 0))
```

```{r Fig2, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center', fig.cap="Map of the Iberian peninsula indicating where the bee occurrences were sampled.",out.width="70%"}
# code courtesy of Paco Rodriguez.
library(sf)
library(raster)
library(rasterVis)
library(tidyverse)
crs.geo <- "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
crs.laea <- "+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs"

library(data.table)
data <- read.table("../Data/iberian_bees.csv.gz", header = T, quote = "\"", sep = ",")

# Prepare data
data$Longitude <- as.numeric(data$Longitude)
data$Latitude <- as.numeric(data$Latitude)
data <- data %>% filter(!is.na(Latitude) & !is.na(Longitude))
# Keep points on balearic islands
data_1 <- data %>% filter(Province == "Balears, Illes")
data_1$Country_1 <- NA

# Filter points in Spain and Portugal
data$Country_1 <- NA
data$Country_1 <- maps::map.where(x = data$Longitude, y = data$Latitude)
data <- data %>% filter(Country_1 == "Spain" | Country_1 == "Portugal")
# Rbind points that are in Spain with the ones of Balearic islands
dat <- rbind(data, data_1)

datos.sf <- st_as_sf(dat,
  coords = c("Longitude", "Latitude"),
  crs = crs.geo
)

datos.laea <- st_transform(datos.sf,
  crs = crs.laea
)

ras <- raster(datos.laea, resolution = 10000)

ras.counts <- rasterize(datos.laea[, "Accepted_name"], ras,
  field = "Accepted_name", fun = "count"
)
# str(datos.laea)
datos.laea$total <- datos.laea$Male + datos.laea$Female + datos.laea$Worker + datos.laea$Not.specified
ras.counts2 <- rasterize(datos.laea[, "total"], ras,
  field = "total", fun = "sum"
)
ras2 <- raster(datos.laea, resolution = 30000)
ras.richness <- rasterize(datos.laea[, "Accepted_name"], ras2,
  field = "Accepted_name", fun = function(x, ...) {
    length(unique(na.omit(x)))
  }
)
library(vegan)
ras.chao <- rasterize(datos.laea[, "Accepted_name"], ras2,
  field = "Accepted_name", fun = function(x, ...) {
    estimateR(t(as.matrix(x = table(x), nrow = 1, ncol = x)))[2, 1]
  }
) # 2 chao, 4 ACE #TO DO THIS WELL, we need to recover abundances.

# levelplot(log(ras.counts+1), margin = FALSE, scales = list(draw = FALSE),
#         par.settings = viridisTheme())
levelplot(log(ras.counts2 + 1),
  margin = FALSE, scales = list(draw = FALSE),
  par.settings = viridisTheme()
)
# levelplot(log(ras.richness+1), margin = FALSE, scales = list(draw = FALSE),
#         par.settings = viridisTheme())
# levelplot(ras.chao, margin = FALSE, scales = list(draw = FALSE),
#         par.settings = viridisTheme())
```

```{r Fig3, echo=FALSE, warning=FALSE, message=FALSE, fig.cap="Cobertura temporal de (A) los años con más ocurrencias, y (B) los meses con más ocurrencias. ", message=FALSE, warning=FALSE, cache=FALSE}
# Prepare top 20 records
by_year <- data %>% filter(!Accepted_name == "Apis mellifera")

p1 <- ggplot(by_year, aes(Year)) +
  geom_histogram(fill = "#287D8EFF") +
  theme_classic() +
  ylab("Number of records") +
  scale_y_continuous(expand = c(0, 0))

data$month_name <- month.abb[data$Month]

month_sum <- data %>%
  group_by(month_name) %>%
  summarise(no_rows = length(month_name)) %>%
  arrange(-no_rows)

month_sum <- month_sum %>% filter(!is.na(month_name))

month_sum$month_name <- factor(month_sum$month_name, levels = c(
  "Jan", "Feb", "Mar",
  "Apr", "May", "Jun",
  "Jul", "Aug", "Sep",
  "Oct", "Nov", "Dec"
))

p2 <- ggplot(data = month_sum, aes(x = month_name, y = no_rows)) +
  geom_bar(stat = "identity", fill = "#287D8EFF") +
  theme_classic() +
  scale_y_continuous(expand = c(0, 0)) +
  ylab("Number of records") +
  xlab("Months")

library(patchwork)

p1 / p2
```



